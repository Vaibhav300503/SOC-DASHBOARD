<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYART - Attack Flow Map</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.cdnfonts.com/css/kiona');
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Montserrat:wght@400;700&family=Outfit:wght@400;700&display=swap');
        
        :root {
          --font-octa: 'Outfit', sans-serif;
          --font-tech: 'JetBrains Mono', monospace;
          --font-brand: 'Kiona', 'Montserrat', sans-serif;
        }

        body { 
          font-family: var(--font-octa);
          background-color: #000000;
          margin: 0;
          color: #888;
        }
        
        .font-brand { font-family: var(--font-brand); font-weight: 400; }
        .font-tech { font-family: var(--font-tech); }
        
        .scrollbar-thin::-webkit-scrollbar { width: 3px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: #000; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #33ff5533; border-radius: 2px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { Shield, Activity, Zap, AlertTriangle, Terminal, Wifi, Server, Globe, Lock, Cpu } = lucide;

        // --- Global Data Constants ---
        const MAX_LOGS = 30;

        const COLORS = {
          background: "#020202",
          panelBg: "rgba(10, 10, 10, 0.6)",
          border: "#33ff55",
          text: "#cccccc",
          danger: "#ff3333",
        };

        // Unique tactical colors for each attack type
        const ATTACK_TYPES = [
          { name: "SMB (445)", color: "#ff4d4d" },      // Red
          { name: "Telnet (23)", color: "#00f2ff" },     // Cyan
          { name: "SSH (22)", color: "#ffee00" },       // Yellow
          { name: "HTTP (80)", color: "#ff00ff" },      // Magenta
          { name: "RDP (3389)", color: "#3d5afe" },     // Electric Blue
        ];

        const INITIAL_COUNTRIES_SRC = [
          { name: "Russia", count: 45021 },
          { name: "China", count: 32104 },
          { name: "USA", count: 21004 },
          { name: "Netherlands", count: 15400 },
          { name: "Brazil", count: 12040 },
        ];

        const INITIAL_COUNTRIES_DST = [
          { name: "USA", count: 89002 },
          { name: "Germany", count: 45001 },
          { name: "Japan", count: 32004 },
          { name: "UK", count: 28000 },
          { name: "India", count: 15000 },
        ];

        // Comprehensive Global Regions (State Wise)
        const REGIONS = [
          { name: "California, USA", lat: 36.7783, lon: -119.4179 },
          { name: "Texas, USA", lat: 31.9686, lon: -99.9018 },
          { name: "New York, USA", lat: 40.7128, lon: -74.0060 },
          { name: "Florida, USA", lat: 27.6648, lon: -81.5158 },
          { name: "Washington, USA", lat: 47.7511, lon: -120.7401 },
          { name: "Ontario, CAN", lat: 51.2538, lon: -85.3232 },
          { name: "Quebec, CAN", lat: 52.9399, lon: -73.5491 },
          { name: "Bavaria, DEU", lat: 48.7904, lon: 11.4979 },
          { name: "Ile-de-France, FRA", lat: 48.8566, lon: 2.3522 },
          { name: "England, GBR", lat: 52.3555, lon: -1.1743 },
          { name: "Lombardy, ITA", lat: 45.4791, lon: 9.8453 },
          { name: "Madrid, ESP", lat: 40.4168, lon: -3.7038 },
          { name: "Moscow Oblast, RUS", lat: 55.7558, lon: 37.6173 },
          { name: "Tokyo, JPN", lat: 35.6762, lon: 139.6503 },
          { name: "Osaka, JPN", lat: 34.6937, lon: 135.5023 },
          { name: "Guangdong, CHN", lat: 23.3790, lon: 113.7633 },
          { name: "Zhejiang, CHN", lat: 29.1832, lon: 120.0934 },
          { name: "Maharashtra, IND", lat: 19.7515, lon: 75.7139 },
          { name: "Karnataka, IND", lat: 15.3173, lon: 75.7139 },
          { name: "Seoul, KOR", lat: 37.5665, lon: 126.9780 },
          { name: "NSW, AUS", lat: -31.2532, lon: 146.9211 },
          { name: "Victoria, AUS", lat: -37.4713, lon: 144.7852 },
          { name: "Sao Paulo, BRA", lat: -23.5505, lon: -46.6333 },
          { name: "Buenos Aires, ARG", lat: -34.6037, lon: -58.3816 },
          { name: "Gauteng, ZAF", lat: -26.2708, lon: 28.1123 },
          { name: "Lagos, NGA", lat: 6.5244, lon: 3.3792 },
          { name: "Cairo, EGY", lat: 30.0444, lon: 31.2357 },
        ];

        const MAP_IMAGE_URL = "https://upload.wikimedia.org/wikipedia/commons/8/80/World_map_-_low_resolution.svg";

        // --- Projection Helper ---
        const project = (lat, lon, width, height) => {
            // Plate CarrÃ©e projection: Maps Lon/Lat directly to X/Y
            const x = (lon + 180) * (width / 360);
            const y = (90 - lat) * (height / 180);
            return { x, y };
        };

        // --- Sub-Components ---

        const DataTable = ({ title, items, total, color }) => {
            return (
                <div className="flex flex-col h-full bg-black border border-[#33ff55]/10 backdrop-blur-md rounded-sm overflow-hidden group hover:border-[#33ff55]/30 transition-colors">
                     <div className="bg-[#111] p-2 border-b border-[#33ff55]/10 flex justify-between items-center">
                        <span className="font-bold text-[10px] uppercase tracking-widest font-tech" style={{ color: color }}>{title}</span>
                        <Server size={12} style={{ color: color }} className="opacity-30"/>
                     </div>
                     <div className="p-2 flex-1 overflow-y-auto scrollbar-thin bg-black/40">
                         {items.map((item, idx) => {
                             const percent = total > 0 ? Math.max((item.count / total) * 100, 2) : 2; 
                             return (
                                 <div key={idx} className="mb-2 last:mb-0">
                                     <div className="flex justify-between text-[9px] mb-1 font-tech">
                                         <span className="text-gray-500">{String(item.name)}</span>
                                         <span style={{ color: item.color || color }}>{Number(item.count).toLocaleString()}</span>
                                     </div>
                                     <div className="h-1 w-full bg-[#0a0a0a] rounded-full overflow-hidden">
                                         <div 
                                            className="h-full rounded-full transition-all duration-1000" 
                                            style={{ width: `${percent}%`, backgroundColor: item.color || color, opacity: 0.8 }}
                                         ></div>
                                     </div>
                                 </div>
                             )
                         })}
                     </div>
                </div>
            );
        };

        const AlertFeed = ({ logs }) => {
            return (
                <div className="flex flex-col h-full bg-black border border-white/5 backdrop-blur-md rounded-sm overflow-hidden hover:border-white/20 transition-colors">
                    <div className="bg-[#111] p-2 border-b border-white/10 flex justify-between items-center">
                        <span className="font-bold text-[10px] text-gray-400 uppercase tracking-widest font-tech">Security Stream</span>
                        <div className="flex items-center gap-1">
                            <span className="relative flex h-1.5 w-1.5">
                              <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-500 opacity-50"></span>
                              <span className="relative inline-flex rounded-full h-1.5 w-1.5 bg-red-500"></span>
                            </span>
                        </div>
                    </div>
                    <div className="flex-1 overflow-y-auto p-2 font-tech text-[9px] scrollbar-thin bg-black/60">
                        <table className="w-full text-left border-collapse">
                            <thead>
                                <tr className="text-gray-600 border-b border-white/5">
                                    <th className="py-1 font-normal uppercase">TIME</th>
                                    <th className="py-1 font-normal uppercase">TARGET</th>
                                    <th className="py-1 font-normal uppercase">VECTOR</th>
                                    <th className="py-1 text-right font-normal uppercase">PRT</th>
                                </tr>
                            </thead>
                            <tbody>
                                {logs.map((log) => (
                                    <tr key={log.id} className="border-b border-white/5 hover:bg-white/5 transition-colors">
                                        <td className="py-1 text-gray-700">{new Date(log.timestamp).toLocaleTimeString([], { hour12: false, hour:'2-digit', minute:'2-digit', second:'2-digit'})}</td>
                                        <td className="py-1 text-gray-400">{log.destination.name.split(',')[0]}</td>
                                        <td className="py-1" style={{ color: log.type.color }}>{log.type.name.split(' ')[0]}</td>
                                        <td className="py-1 text-right text-gray-500">{log.type.name.match(/\((\d+)\)/)?.[1] || '80'}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const CyberMap = ({ activeAttacks }) => {
          const canvasRef = useRef(null);
          const containerRef = useRef(null);
          const particlesRef = useRef([]);
          const ripplesRef = useRef([]);
          const labelsRef = useRef([]);

          useEffect(() => {
            if (!containerRef.current) return;
            activeAttacks.forEach(att => {
                if (particlesRef.current.find(p => p.id === att.id)) return;
                
                labelsRef.current.push({ text: att.source.name, lat: att.source.lat, lon: att.source.lon, life: 1.0, color: att.type.color });
                particlesRef.current.push({ id: att.id, source: att.source, destination: att.destination, color: att.type.color, progress: 0, speed: 0.003 + (Math.random() * 0.003) });
            });
          }, [activeAttacks]);

          useEffect(() => {
            const canvas = canvasRef.current;
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            let animationId;

            const render = () => {
              if (!canvas || !containerRef.current) return;
              const { offsetWidth: w, offsetHeight: h } = containerRef.current;
              if (w === 0 || h === 0) { animationId = requestAnimationFrame(render); return; }
              if (canvas.width !== w || canvas.height !== h) { canvas.width = w; canvas.height = h; }
              ctx.clearRect(0, 0, w, h);
              
              for (let i = particlesRef.current.length - 1; i >= 0; i--) {
                  const p = particlesRef.current[i];
                  p.progress += p.speed;
                  const startPos = project(p.source.lat, p.source.lon, w, h);
                  const endPos = project(p.destination.lat, p.destination.lon, w, h);

                  if (p.progress >= 1) {
                      labelsRef.current.push({ text: p.destination.name, lat: p.destination.lat, lon: p.destination.lon, life: 1.0, color: p.color });
                      ripplesRef.current.push({ x: endPos.x, y: endPos.y, radius: 0, maxRadius: 20, alpha: 0.8, color: p.color });
                      particlesRef.current.splice(i, 1);
                      continue;
                  }

                  const dx = endPos.x - startPos.x;
                  const dy = endPos.y - startPos.y;
                  const dist = Math.sqrt(dx * dx + dy * dy);
                  const controlX = ((startPos.x + endPos.x) / 2) + (-dy / (dist || 1) * Math.min(dist * 0.25, 120));
                  const controlY = ((startPos.y + endPos.y) / 2) + (dx / (dist || 1) * Math.min(dist * 0.25, 120));

                  const t = p.progress;
                  const x = (1-t)**2 * startPos.x + 2*(1-t)*t * controlX + t**2 * endPos.x;
                  const y = (1-t)**2 * startPos.y + 2*(1-t)*t * controlY + t**2 * endPos.y;

                  const gradient = ctx.createLinearGradient(startPos.x, startPos.y, endPos.x, endPos.y);
                  gradient.addColorStop(0, p.color);
                  gradient.addColorStop(1, p.color + "22");

                  ctx.beginPath();
                  ctx.moveTo(startPos.x, startPos.y);
                  ctx.quadraticCurveTo(controlX, controlY, x, y);
                  ctx.strokeStyle = gradient;
                  ctx.lineWidth = 2;
                  ctx.globalAlpha = 0.5;
                  ctx.stroke();
                  
                  ctx.beginPath();
                  ctx.fillStyle = p.color;
                  ctx.shadowBlur = 10;
                  ctx.shadowColor = p.color;
                  ctx.arc(x, y, 2, 0, Math.PI * 2);
                  ctx.fill();
                  ctx.shadowBlur = 0;
                  ctx.globalAlpha = 1.0;
              }

              for (let i = ripplesRef.current.length - 1; i >= 0; i--) {
                  const r = ripplesRef.current[i];
                  r.radius += 0.4; r.alpha -= 0.02;
                  if (r.alpha <= 0) { ripplesRef.current.splice(i, 1); continue; }
                  ctx.beginPath();
                  ctx.strokeStyle = r.color;
                  ctx.globalAlpha = r.alpha;
                  ctx.arc(r.x, r.y, r.radius, 0, Math.PI * 2);
                  ctx.stroke();
                  ctx.globalAlpha = 1.0;
              }

              ctx.textAlign = 'center';
              ctx.font = 'bold 13px "JetBrains Mono", monospace';
              
              for (let i = labelsRef.current.length - 1; i >= 0; i--) {
                  const l = labelsRef.current[i];
                  l.life -= 0.008;
                  const pos = project(l.lat, l.lon, w, h);
                  if (l.life <= 0) { labelsRef.current.splice(i, 1); continue; }

                  ctx.globalAlpha = l.life;
                  ctx.fillStyle = l.color;
                  ctx.shadowBlur = 4;
                  ctx.shadowColor = 'rgba(0,0,0,1)';
                  
                  const stateName = l.text.split(',')[0].toUpperCase();
                  ctx.fillText(stateName, pos.x, pos.y - 15 - (1.0 - l.life) * 20);
                  
                  ctx.shadowBlur = 0;
                  ctx.globalAlpha = 1.0;
              }

              animationId = requestAnimationFrame(render);
            };
            render();
            return () => cancelAnimationFrame(animationId);
          }, []);

          return (
            <div ref={containerRef} className="relative w-full h-full bg-black rounded-sm border-t border-b border-[#33ff55]/5 overflow-hidden">
                <div className="absolute inset-0 opacity-20 pointer-events-none"
                    style={{
                        backgroundImage: `url(${MAP_IMAGE_URL})`,
                        backgroundSize: '100% 100%',
                        backgroundPosition: 'center',
                        backgroundRepeat: 'no-repeat',
                        filter: 'invert(1) sepia(1) hue-rotate(95deg) saturate(2) brightness(0.4) contrast(1.5)' 
                    }}
                />
                <canvas ref={canvasRef} className="absolute inset-0 block w-full h-full z-10" />
            </div>
          );
        };

        // --- Main App ---

        function App() {
          const [activeAttacks, setActiveAttacks] = useState([]);
          const [logs, setLogs] = useState([]);
          const [stats, setStats] = useState({ total: 452901 });
          const [isScrolled, setIsScrolled] = useState(false);
          
          const [srcData, setSrcData] = useState(INITIAL_COUNTRIES_SRC);
          const [dstData, setDstData] = useState(INITIAL_COUNTRIES_DST);
          const [protocolData, setProtocolData] = useState(ATTACK_TYPES.map(t => ({...t, count: 5000})));

          useEffect(() => {
            const handleScroll = () => setIsScrolled(window.scrollY > 50);
            window.addEventListener('scroll', handleScroll);
            return () => window.removeEventListener('scroll', handleScroll);
          }, []);

          useEffect(() => {
            // WebSocket connection for real-time attacks
            const ws = new WebSocket('ws://localhost:3001');
            
            ws.onmessage = (event) => {
                const message = JSON.parse(event.data);
                if (message.type === 'attack') {
                    const attack = message.data;
                    setActiveAttacks(prev => [...prev, attack]);
                    setLogs(prev => [attack, ...prev].slice(0, MAX_LOGS));
                    setStats(prev => ({ total: prev.total + 1 }));

                    const srcCountry = attack.source.name.split(', ')[1] || 'Global';
                    const dstCountry = attack.destination.name.split(', ')[1] || 'Global';

                    setSrcData(prev => {
                        const exists = prev.find(c => c.name === srcCountry);
                        if (exists) return prev.map(c => c.name === srcCountry ? {...c, count: c.count + 1} : c);
                        const newList = [...prev, { name: srcCountry, count: 1 }];
                        return newList.sort((a,b) => b.count - a.count).slice(0, 5);
                    });

                    setDstData(prev => {
                        const exists = prev.find(c => c.name === dstCountry);
                        if (exists) return prev.map(c => c.name === dstCountry ? {...c, count: c.count + 1} : c);
                        const newList = [...prev, { name: dstCountry, count: 1 }];
                        return newList.sort((a,b) => b.count - a.count).slice(0, 5);
                    });

                    const typeIdx = ATTACK_TYPES.findIndex(t => t.name === attack.type.name);
                    if (typeIdx !== -1) {
                        setProtocolData(prev => prev.map((p, i) => i === typeIdx ? {...p, count: p.count + 1} : p));
                    }

                    setTimeout(() => setActiveAttacks(prev => prev.filter(a => a.id !== attack.id)), 8000);
                }
            };

            ws.onopen = () => console.log('Connected to attack flow server');
            ws.onerror = (error) => console.error('WebSocket error:', error);
            ws.onclose = () => console.log('Disconnected from attack flow server');

            return () => {
                ws.close();
            };
          }, []);

          return (
            <div className="w-screen h-screen flex flex-col overflow-hidden p-2 gap-2 bg-black">
                <header className={`fixed top-0 left-0 w-full z-50 transition-all duration-700 ${isScrolled ? 'bg-black/90 py-4 backdrop-blur-lg' : 'bg-transparent py-6' }`}>
                      <div className="max-w-7xl mx-auto px-10 flex items-center justify-between">
                        <div className="flex items-center gap-6 group cursor-pointer shrink-0">
                          <div className="relative w-8 h-8 flex items-center justify-center">
                            <div className="absolute inset-0 border border-[#33ff55]/20 rotate-45" />
                            <Shield className="w-4 h-4 text-[#33ff55] opacity-80" />
                          </div>
                          <span className="text-xl md:text-2xl font-brand tracking-[0.4em] leading-none text-gray-300 uppercase">CYART</span>
                        </div>

                        <div className="flex gap-10 font-tech">
                             <div className="text-right">
                                 <div className="text-[9px] text-gray-600 uppercase tracking-widest font-bold mb-1">Total Threats</div>
                                 <div className="text-xl text-[#ff9900]/90 leading-none">{stats.total.toLocaleString()}</div>
                             </div>
                             <div className="text-right">
                                 <div className="text-[9px] text-gray-600 uppercase tracking-widest font-bold mb-1">Status</div>
                                 <div className="text-xl text-[#ff3333]/90 leading-none animate-pulse font-bold">LIVE</div>
                             </div>
                        </div>
                      </div>
                </header>

                <div className="flex-1 min-h-0 relative mt-24">
                     <div className="absolute top-4 left-4 z-20 flex gap-4 font-tech pointer-events-none">
                         <div className="bg-black/90 border border-[#33ff55]/10 p-2 backdrop-blur-md rounded-sm">
                             <div className="text-[9px] text-gray-600 uppercase mb-1">Active Vectors</div>
                             <div className="text-lg font-bold text-[#33ff55]/80">TRACKING</div>
                         </div>
                         <div className="bg-black/90 border border-[#ff9900]/10 p-2 backdrop-blur-md rounded-sm">
                             <div className="text-[9px] text-gray-600 uppercase mb-1">Attack Intensity</div>
                             <div className="text-lg font-bold text-[#ff9900]/80">MODERATE</div>
                         </div>
                     </div>
                     <CyberMap activeAttacks={activeAttacks} />
                </div>

                <div className="h-60 shrink-0 grid grid-cols-4 gap-2 font-tech">
                     <DataTable title="Inbound Sources" items={srcData} total={stats.total * 0.2 + 50000} color="#ff9900" />
                     <DataTable title="Target Clusters" items={dstData} total={stats.total * 0.2 + 100000} color="#33ff55" />
                     <DataTable title="Vector Protocols" items={protocolData} total={stats.total} color="#00f2ff" />
                     <AlertFeed logs={logs} />
                </div>
            </div>
          );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
