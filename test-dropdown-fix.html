<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dropdown Fix Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: white; }
        .test-container { max-width: 800px; margin: 0 auto; }
        .test-row { display: flex; align-items: center; padding: 10px; margin: 5px 0; background: #2a2a2a; border-radius: 5px; }
        .test-button { background: #4a5568; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; margin-left: auto; }
        .test-button:hover { background: #5a6578; }
        .test-button.active { background: #63b3ed; }
        .dropdown { position: absolute; right: 0; top: 100%; background: #2d3748; border: 1px solid #4a5568; border-radius: 4px; min-width: 150px; z-index: 1000; }
        .dropdown-item { padding: 8px 12px; cursor: pointer; border-bottom: 1px solid #4a5568; }
        .dropdown-item:hover { background: #4a5568; }
        .dropdown-item:last-child { border-bottom: none; }
        .relative { position: relative; }
        .backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.2); z-index: 999; }
        .success { color: #48bb78; }
        .error { color: #f56565; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Dropdown Isolation Test</h1>
        <p>This test verifies that only ONE dropdown can be open at a time.</p>
        
        <div id="test-results"></div>
        
        <div class="test-row">
            <span>Log Entry #1 - 192.168.1.100</span>
            <div class="relative">
                <button class="test-button" onclick="toggleMenu(1)" id="btn-1">‚ãÆ</button>
                <div class="dropdown" id="dropdown-1" style="display: none;">
                    <div class="dropdown-item" onclick="executeAction('block', 1)">Block IP</div>
                    <div class="dropdown-item" onclick="executeAction('alert', 1)">Create Alert</div>
                    <div class="dropdown-item" onclick="executeAction('investigate', 1)">Investigate</div>
                </div>
            </div>
        </div>
        
        <div class="test-row">
            <span>Log Entry #2 - 192.168.1.101</span>
            <div class="relative">
                <button class="test-button" onclick="toggleMenu(2)" id="btn-2">‚ãÆ</button>
                <div class="dropdown" id="dropdown-2" style="display: none;">
                    <div class="dropdown-item" onclick="executeAction('block', 2)">Block IP</div>
                    <div class="dropdown-item" onclick="executeAction('alert', 2)">Create Alert</div>
                    <div class="dropdown-item" onclick="executeAction('investigate', 2)">Investigate</div>
                </div>
            </div>
        </div>
        
        <div class="test-row">
            <span>Log Entry #3 - 192.168.1.102</span>
            <div class="relative">
                <button class="test-button" onclick="toggleMenu(3)" id="btn-3">‚ãÆ</button>
                <div class="dropdown" id="dropdown-3" style="display: none;">
                    <div class="dropdown-item" onclick="executeAction('block', 3)">Block IP</div>
                    <div class="dropdown-item" onclick="executeAction('alert', 3)">Create Alert</div>
                    <div class="dropdown-item" onclick="executeAction('investigate', 3)">Investigate</div>
                </div>
            </div>
        </div>
        
        <div id="backdrop" class="backdrop" style="display: none;" onclick="closeAllMenus()"></div>
    </div>

    <script>
        let activeMenuId = null;
        let testResults = [];

        function logTest(message, success = true) {
            testResults.push({ message, success, timestamp: new Date().toLocaleTimeString() });
            updateTestResults();
        }

        function updateTestResults() {
            const container = document.getElementById('test-results');
            container.innerHTML = '<h3>Test Results:</h3>' + 
                testResults.map(result => 
                    `<div class="${result.success ? 'success' : 'error'}">[${result.timestamp}] ${result.message}</div>`
                ).join('');
        }

        function toggleMenu(logId) {
            console.log('Toggle menu for log:', logId, 'Current active:', activeMenuId);
            
            // Test: Check if multiple menus are open (should never happen)
            const openMenus = document.querySelectorAll('.dropdown[style*="block"]').length;
            if (openMenus > 1) {
                logTest(`‚ùå CRITICAL: ${openMenus} menus are open simultaneously!`, false);
            }
            
            // If clicking the same menu that's already open, close it
            if (activeMenuId === logId) {
                closeAllMenus();
                logTest(`‚úÖ Closed menu for log ${logId}`);
                return;
            }
            
            // Close any open menu and open the new one
            closeAllMenus();
            activeMenuId = logId;
            
            // Show the dropdown and backdrop
            document.getElementById(`dropdown-${logId}`).style.display = 'block';
            document.getElementById(`btn-${logId}`).classList.add('active');
            document.getElementById('backdrop').style.display = 'block';
            
            logTest(`‚úÖ Opened menu for log ${logId}`);
            
            // Verify only one menu is open
            const nowOpenMenus = document.querySelectorAll('.dropdown[style*="block"]').length;
            if (nowOpenMenus === 1) {
                logTest(`‚úÖ Isolation verified: Only 1 menu open`);
            } else {
                logTest(`‚ùå Isolation failed: ${nowOpenMenus} menus open`, false);
            }
        }

        function closeAllMenus() {
            console.log('Closing all menus, was:', activeMenuId);
            
            // Hide all dropdowns
            document.querySelectorAll('.dropdown').forEach(dropdown => {
                dropdown.style.display = 'none';
            });
            
            // Remove active state from all buttons
            document.querySelectorAll('.test-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Hide backdrop
            document.getElementById('backdrop').style.display = 'none';
            
            if (activeMenuId !== null) {
                logTest(`‚úÖ Closed menu for log ${activeMenuId}`);
            }
            
            activeMenuId = null;
        }

        function executeAction(action, logId) {
            console.log('Execute action:', action, 'for log:', logId);
            logTest(`‚úÖ Executed ${action} for log ${logId}`);
            closeAllMenus();
        }

        // Test isolation on page load
        window.onload = function() {
            logTest('‚úÖ Dropdown isolation test initialized');
            logTest('üìù Click the ‚ãÆ buttons to test dropdown isolation');
        };
    </script>
</body>
</html>